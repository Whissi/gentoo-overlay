From b6daf39058c2065f1eb33d335fdc8096ec520af3 Mon Sep 17 00:00:00 2001
From: Mike Place <mp@saltstack.com>
Date: Wed, 16 Apr 2014 12:49:17 -0600
Subject: [PATCH] Make jobs.active work correctly.

* Fixed output of running minions (#9526)
* Correctly identify returned minions.
---
 salt/runners/jobs.py | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/salt/runners/jobs.py b/salt/runners/jobs.py
index 3690827..197d196 100644
--- a/salt/runners/jobs.py
+++ b/salt/runners/jobs.py
@@ -34,7 +34,7 @@ def active():
         for job in data:
             if not job['jid'] in ret:
                 ret[job['jid']] = _format_job_instance(job)
-                ret[job['jid']].update({'Running': [], 'Returned': []})
+                ret[job['jid']].update({'Running': [{minion: job.get('pid', None)}], 'Returned': []})
             else:
                 ret[job['jid']]['Running'].append({minion: job['pid']})
     for jid in ret:
@@ -45,7 +45,7 @@ def active():
         if not os.path.isdir(jid_dir):
             continue
         for minion in os.listdir(jid_dir):
-            if minion.startswith('.'):
+            if minion.startswith('.') or minion == 'jid':
                 continue
             if os.path.exists(os.path.join(jid_dir, minion)):
                 ret[jid]['Returned'].append(minion)
-- 
1.9.1

