From 58bfe4c865ff1beeee746a11fd26119d07001a59 Mon Sep 17 00:00:00 2001
From: Thomas D.
Date: Sun, 13 Sep 2015 21:21:50 +0200
Subject: [PATCH] pydsl includes test workaround

Workaround for upstream issue #20504
---
 tests/unit/pydsl_test.py | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/tests/unit/pydsl_test.py b/tests/unit/pydsl_test.py
index 2f39a41..ac9eae4 100644
--- a/tests/unit/pydsl_test.py
+++ b/tests/unit/pydsl_test.py
@@ -521,6 +521,13 @@ class PyDSLRendererIncludeTestCase(CommonTestCaseBoilerplate):
                     state(color).cmd.run('echo hello '+color+' '+str(number)+' >> {3}', cwd='/')
                 '''.format(output, output, output, output)))
 
+            # Because salt.fileserver caches for 30sec per default
+            # we need to make sure to wait at least 30sec before calling
+            # the highstate or salt won't find the new created files
+            # (see upstream issue #20504 for more details)
+            import time
+            time.sleep(30)
+
             self.state_highstate({'base': ['aaa']}, dirpath)
             expected = textwrap.dedent('''\
                 X1
-- 
2.5.1

